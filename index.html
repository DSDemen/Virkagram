<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="v.jpg" type="image/jpeg">
    <title>–í—ñ—Ä–∫–∞–≥—Ä–∞–º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #1e1e1e;
            color: white;
            display: flex;
            height: 100vh;
        }

        /* –õ–µ–≤–æ–µ –º–µ–Ω—é */
        #sidebar {
            width: 300px;
            background-color: #2a2a2a;
            padding: 10px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è sidebar */
        #sidebar h2 {
            font-size: 1.2em;
            margin-bottom: 20px;
            color: #fbbc05;
        }

        /* –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ */
        #chatList {
            flex-grow: 1;
            overflow-y: auto;
        }

        .chatItem {
            padding: 15px;
            margin-bottom: 5px;
            background-color: #333;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        .chatItem:hover {
            background-color: #444;
        }

        .chatItem img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .chatItem .name {
            font-weight: bold;
        }

        /* –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ */
        #chatArea {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            background-color: #121212;
            border-left: 1px solid #333;
        }

        #messages {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .message {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 8px;
            display: flex; /* –ß—Ç–æ–±—ã —ç–ª–µ–º–µ–Ω—Ç—ã –±—ã–ª–∏ –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ */
            flex-direction: column; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö */
        .message .message-image {
            max-width: 60%; /* –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ–¥ —Ä–∞–∑–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è */
            max-height: 400px; /* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–ø–æ—Ä—Ü–∏–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è */
            border-radius: 5px; /* –ó–∞–∫—Ä—É–≥–ª–µ–Ω–∏–µ —É–≥–ª–æ–≤ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π */
            margin-top: 10px; /* –û—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É –æ—Ç —Ç–µ–∫—Å—Ç–∞ –¥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è */
            display: block; /* –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞–∫ –±–ª–æ—á–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* –ù–µ–±–æ–ª—å—à–∞—è —Ç–µ–Ω—å –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞ */
            height: auto;
        }

        .username {
            font-size: 0.9em; /* –£–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è */
            color: #fbbc05; /* –¶–≤–µ—Ç –¥–ª—è –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è */
            margin-bottom: 5px; /* –û—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –∏–º–µ–Ω–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ–º */
        }

        .message-text {
            font-size: 1em; /* –†–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è */
            color: white; /* –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è */
        }

        .message.user {
            background-color: #2f80ed;
            color: white;
            align-self: flex-end;
        }

        .message.other {
            background-color: #333;
            color: white;
            align-self: flex-start;
        }

        .message img {
            max-width: 100px;
            max-height: 100px;
            display: block;
        }

        #inputArea {
            display: flex;
            padding: 15px;
            background-color: #1e1e1e;
            border-top: 1px solid #333;
        }

        #messageInput {
            flex-grow: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            margin-right: 10px;
            background-color: #333;
            color: white;
        }

        #messageInput:focus {
            outline: none;
        }

        #fileInput {
            display: none;
        }

        #sendButton {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background-color: #fbbc05;
            color: #121212;
            cursor: pointer;
        }

        #sendButton:hover {
            background-color: #e0a600;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ */
        #uploadButton {
            padding: 10px;
            background-color: #444;
            border-radius: 8px;
            margin-right: 10px;
            cursor: pointer;
        }

        #uploadButton:hover {
            background-color: #555;
        }
        
        .menu-button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 10px;
            margin-bottom: 20px;
        }

        .bar {
           display: block;
           width: 30px;
           height: 3px;
           background-color: #fbbc05;
           margin: 5px 0;
           transition: 0.4s;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ */
        .menu-button.active .bar:nth-child(1) {
            transform: rotate(-45deg) translate(-5px, 6px);
        }

        .menu-button.active .bar:nth-child(2) {
            opacity: 0;
        }

        .menu-button.active .bar:nth-child(3) {
            transform: rotate(45deg) translate(-5px, -6px);
        }

        #menu {
            list-style-type: none;
            padding: 0;
        }

        #menu li {
            margin: 10px 0;
        }

        #menu li a {
            color: #fbbc05;
            text-decoration: none;
        }

        #menu li a:hover {
            text-decoration: underline;
        }

        /* –°–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        #menu {
            display: none;
        }        

        /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ */
        #sidebar.open #menu {
            display: block;
        }

        #auth {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
        }

        #auth h2 {
            margin-bottom: 20px;
            color: #fbbc05; /* –¶–≤–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞ */
        }
    
        .auth-input {
            width: 300px; /* –®–∏—Ä–∏–Ω–∞ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ */
            padding: 15px; /* –û—Ç—Å—Ç—É–ø –≤–Ω—É—Ç—Ä–∏ –ø–æ–ª–µ–π */
            margin-bottom: 15px; /* –û—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –ø–æ–ª—è–º–∏ */
            border: none; /* –£–±–∏—Ä–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã */
            border-radius: 8px; /* –°–∫—Ä—É–≥–ª–µ–Ω–∏–µ —É–≥–ª–æ–≤ */
            background-color: #333; /* –¶–≤–µ—Ç —Ñ–æ–Ω–∞ –ø–æ–ª–µ–π */
            color: white; /* –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ */
            font-size: 16px; /* –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
        }

        .auth-input::placeholder {
            color: #888; /* –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞ */
        }

        .auth-input:focus {
            outline: none; /* –£–±–∏—Ä–∞–µ–º –æ–±–≤–æ–¥ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ */
            background-color: #444; /* –¶–≤–µ—Ç —Ñ–æ–Ω–∞ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ */
        }

        .auth-buttons {
            display: flex; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –≤ —Ä—è–¥ */
            justify-content: space-between;
            width: 300px; /* –®–∏—Ä–∏–Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∫–Ω–æ–ø–æ–∫ */
        }

        .auth-button {
            padding: 10px 20px; /* –û—Ç—Å—Ç—É–ø—ã –≤–Ω—É—Ç—Ä–∏ –∫–Ω–æ–ø–æ–∫ */
            border: none; /* –£–±–∏—Ä–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã */
            border-radius: 8px; /* –°–∫—Ä—É–≥–ª–µ–Ω–∏–µ —É–≥–ª–æ–≤ */
            background-color: #fbbc05; /* –¶–≤–µ—Ç —Ñ–æ–Ω–∞ –∫–Ω–æ–ø–æ–∫ */
            color: #121212; /* –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ */
            cursor: pointer; /* –£–∫–∞–∑–∞—Ç–µ–ª—å –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
            font-size: 16px; /* –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            transition: background-color 0.3s; /* –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ */
        }

        .auth-button:hover {
            background-color: #e0a600; /* –¶–≤–µ—Ç —Ñ–æ–Ω–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        }

        /* –û–±–ª–∞—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
        #settingsArea {
            padding: 20px;
            background-color: #1e1e1e;
            color: white;
            border-left: 1px solid #333;
            max-width: 600px;
            border-radius: 10px;
        }

        /* –û—Ç—Å—Ç—É–ø—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ */
        .setting-option {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —è—Ä–ª—ã–∫–æ–≤ */
        .setting-option label {
            margin-right: 10px;
            font-size: 16px;
        }

        /* –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ */
        .custom-select {
            width: 100%;
            padding: 10px;
            background-color: #333;
            color: white;
            border: 1px solid #555;
            border-radius: 5px;
            font-size: 16px;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            cursor: pointer;
        }

        .custom-select:focus {
            border-color: #2f80ed;
            outline: none;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è */
        .custom-button {
            padding: 10px 20px;
            background-color: #2f80ed;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .custom-button:hover {
            background-color: #1e5bb8;
        }

        .custom-button:focus {
            outline: none;
        }

        /* –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ */
        .custom-file-input {
            padding: 10px;
            background-color: #333;
            color: #ccc;
            border: 1px solid #555;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
        }

        .custom-file-input:hover {
            background-color: #444;
        }

        .custom-file-input:focus {
            outline: none;
            border-color: #2f80ed;
        }

        /* –°—Ç–∏–ª—å –¥–ª—è —Ç–µ–∫—Å—Ç–∞ –≤ –±–ª–æ–∫–µ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ */
        .custom-file-input::file-selector-button {
            color: white;
            background-color: #2f80ed;
            border: none;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .custom-file-input::file-selector-button:hover {
            background-color: #1e5bb8;
        }
        .message-date {
            color: #000000; /* –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∂–µ–ª–∞–µ–º—ã–π —Ü–≤–µ—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–∏–Ω–∏–π */
            font-weight: normal; /* –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Å–¥–µ–ª–∞—Ç—å —Ç–µ–∫—Å—Ç –∂–∏—Ä–Ω—ã–º */
            font-size: 0.8em;
        }
        /* –°—Ç–∏–ª—å –¥–ª—è —ç–∫—Ä–∞–Ω–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ä–∞–±–æ—Ç */
        .maintenance-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background-color: #000000;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 9999; /* –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ */
            font-family: Arial, sans-serif;
        }

        .maintenance-screen h1 {
            font-size: 48px;
            color: #fff;
            margin-bottom: 20px;
        }

        .maintenance-screen p {
            font-size: 24px;
            color: #fff;
        }
        .avatar {
            width: 40px; /* –®–∏—Ä–∏–Ω–∞ –∞–≤–∞—Ç–∞—Ä–∞ */
            height: 40px; /* –í—ã—Å–æ—Ç–∞ –∞–≤–∞—Ç–∞—Ä–∞ */
            border-radius: 50%; /* –ö—Ä—É–≥–ª—ã–π –∞–≤–∞—Ç–∞—Ä */
            margin-right: 8px; /* –û—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –∞–≤–∞—Ç–∞—Ä–æ–º –∏ —Ç–µ–∫—Å—Ç–æ–º */
            vertical-align: middle; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
        }

    </style>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-storage-compat.js"></script>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCQEYE3QPOOUCXp7V5rYE2GMuWN8gamYWk",
            authDomain: "virkogram.firebaseapp.com",
            databaseURL: "https://virkogram-default-rtdb.firebaseio.com",
            projectId: "virkogram",
            storageBucket: "virkogram.appspot.com",
            messagingSenderId: "231177905104",
            appId: "1:231177905104:web:0762592f363939f47a0fd5",
            measurementId: "G-XM8J8E6FCY"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        const storage = firebase.storage();
        let hasDateRendered = false;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—è "undermaint" –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        db.ref('undermaint').on('value', (snapshot) => {
            const isUnderMaintenance = snapshot.val();

            if (isUnderMaintenance) {
                // –ï—Å–ª–∏ —Å–∞–π—Ç –Ω–∞ —Ç–µ—Ö. —Ä–∞–±–æ—Ç–∞—Ö, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω
                 document.querySelector('.maintenance-screen').style.display = 'flex';
            } else {
                // –ï—Å–ª–∏ —Ç–µ—Ö. —Ä–∞–±–æ—Ç –Ω–µ—Ç, —Å–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∞–π—Ç
                document.querySelector('.maintenance-screen').style.display = 'none';
            }
        });
        
        document.addEventListener("DOMContentLoaded", () => {
            const menuButton = document.getElementById('menuButton');
            const logoutButton = document.getElementById('logoutButton'); // –ü–æ–ª—É—á–∞–µ–º –∫–Ω–æ–ø–∫—É –≤—ã—Ö–æ–¥–∞
            const fileInput = document.getElementById('fileInput');
            const previewImage = document.getElementById('previewImage');
            const removeImageButton = document.getElementById('removeImage');
            const settingsButton = document.getElementById('settingsButton');
            const chatArea = document.getElementById('chatArea');
            const settingsArea = document.getElementById('settingsArea');
            const changepassb = document.getElementById('changepass');

            // –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É
            settingsButton.addEventListener('click', (event) => {
                if (chatArea.style.display === 'flex') {
                    event.preventDefault();
                    settingsArea.style.display = 'block';
                    chatArea.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç, –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç
                }
            });

            changepassb.addEventListener('click', (event) => {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º prompt –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è
                const newPassword = prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:");

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤–≤–µ–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å
                if (newPassword) {
                    // –ü–æ–ª—É—á–∏—Ç–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    const user = firebase.auth().currentUser;

                    // –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
                    if (user) {
                        // –û–±–Ω–æ–≤–∏—Ç–µ –ø–∞—Ä–æ–ª—å
                        user.updatePassword(newPassword).then(() => {
                            alert('–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω!');
                            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–¥ –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                        }).catch((error) => {
                            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª—è:', error);
                            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª—è: ' + error.message);
                            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
                        });
                    } else {
                        alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω.');
                        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —É–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ —Ç–æ–º, —á—Ç–æ –æ–Ω –¥–æ–ª–∂–µ–Ω –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
                    }
                } else {
                    alert('–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –Ω–µ –±—ã–ª –≤–≤–µ–¥–µ–Ω.');
                }
            });

            // –î–æ–±–∞–≤–∏–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
            const saveButton = document.getElementById('saveSettings');
            saveButton.addEventListener('click', () => {
                const selectedTheme = document.getElementById('themeSelect').value;
                const avatarFile = document.getElementById('avatarInput').files[0];

                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                alert(`–í—ã –≤—ã–±—Ä–∞–ª–∏ —Ç–µ–º—É: ${selectedTheme}`);

                if (avatarFile) {
                    alert(`–í—ã–±—Ä–∞–Ω —Ñ–∞–π–ª –∞–≤–∞—Ç–∞—Ä–∞: ${avatarFile.name}`);
                    // –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –∞–≤–∞—Ç–∞—Ä–∞ —á–µ—Ä–µ–∑ Firebase Storage –∏–ª–∏ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–∏—Å
                }

                // –í–µ—Ä–Ω—É—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±—Ä–∞—Ç–Ω–æ –≤ —á–∞—Ç
                settingsArea.style.display = 'none';
                chatArea.style.display = 'flex';
            });

            fileInput.addEventListener('change', () => {
                const file = fileInput.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        previewImage.src = e.target.result; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –ø—Ä–µ–≤—å—é
                        previewImage.style.display = 'block'; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                        removeImageButton.style.display = 'inline'; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è
                    }
                    reader.readAsDataURL(file); // –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª –∫–∞–∫ Data URL
                }
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            removeImageButton.addEventListener('click', () => {
                fileInput.value = ''; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–∞–π–ª
                previewImage.src = ''; // –£–±–∏—Ä–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                previewImage.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                removeImageButton.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è
            });
    
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é
            menuButton.addEventListener('click', () => {
                menuButton.classList.toggle('active'); // –ú–µ–Ω—è–µ–º –∫–ª–∞—Å—Å –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.toggle('open'); // –î–æ–±–∞–≤–ª—è–µ–º/—É–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é
            });

            document.getElementById('daterenderb').addEventListener('click', function() {
                hasDateRendered = !hasDateRendered; // –ú–µ–Ω—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
                updateButtonText(); // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
            });


            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ –≤—ã—Ö–æ–¥–∞
            logoutButton.addEventListener('click', (event) => {
                if (settingsArea.style.display === 'none' || settingsArea.style.display === '') {
                    
                    event.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ —Å—Å—ã–ª–∫–µ
                    auth.signOut() // –í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞ Firebase
                        .then(() => {
                            alert("–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞!"); // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≤—ã—Ö–æ–¥–µ
                             // –û–±–Ω–æ–≤–∏—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                            document.getElementById('auth').style.display = 'block';
                            document.getElementById('chatArea').style.display = 'none';
                        })
                        .catch((error) => {
                            console.error("–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞: ", error);
                        });
                }
            });

            
            const signupBtn = document.getElementById('signup');
            const loginBtn = document.getElementById('login');
            const sendBtn = document.getElementById('sendButton');

            if (signupBtn) {
                signupBtn.onclick = () => {
                    const email = document.getElementById('email').value;
                    const password = document.getElementById('password').value;
                    auth.createUserWithEmailAndPassword(email, password)
                        .then(() => {
                            alert("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!");
                        })
                        .catch(error => {
                            alert(error.message);
                        });
                };
            }

            if (loginBtn) {
                loginBtn.onclick = () => {
                    const email = document.getElementById('email').value;
                    const password = document.getElementById('password').value;
                    auth.signInWithEmailAndPassword(email, password)
                        .then(() => {
                            document.getElementById('auth').style.display = 'none';
                            document.getElementById('chatArea').style.display = 'flex'; // Corrected ID
                            loadMessages();
                        })
                        .catch(error => {
                            alert(error.message);
                        });
                };
            }

            if (sendBtn) {
                sendBtn.onclick = () => {
                    const message = document.getElementById('messageInput').value;
                    const fileInput = document.getElementById('fileInput');

                    if (fileInput.files[0]) {
                        uploadImage(fileInput.files[0]);
                    } else {
                        sendMessage({ text: message });
                    }
                };
            }

            function updateButtonText() {
                    const button = document.getElementById('daterenderb'); // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –∫–Ω–æ–ø–∫–∏
                    button.textContent = `–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –¥–∞—Ç—É: ${hasDateRendered}`; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
            }
            
            function applyTheme(theme) {
                if (theme === 'chai') {
                    const otherMessages = document.querySelectorAll('.message.other');
        
                    // –ù–æ–≤—ã–π —Ü–≤–µ—Ç —Ñ–æ–Ω–∞, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ç–∏–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                    const newBackgroundColor = '#33393F'; // –ù–∞–ø—Ä–∏–º–µ—Ä, –æ—Ä–∞–Ω–∂–µ–≤—ã–π
        
                    // –ü—Ä–æ—Ö–æ–¥–∏–º—Å—è –ø–æ –∫–∞–∂–¥–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É –∏ –º–µ–Ω—è–µ–º –µ–≥–æ —Ü–≤–µ—Ç —Ñ–æ–Ω–∞
                    otherMessages.forEach(message => {
                        message.style.backgroundColor = newBackgroundColor;
                    });

                    const otherMessages2 = document.querySelectorAll('.message.user');
        
                    // –ù–æ–≤—ã–π —Ü–≤–µ—Ç —Ñ–æ–Ω–∞, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ç–∏–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                    const newBackgroundColor2 = '#2B4143'; // –ù–∞–ø—Ä–∏–º–µ—Ä, –æ—Ä–∞–Ω–∂–µ–≤—ã–π
        
                    // –ü—Ä–æ—Ö–æ–¥–∏–º—Å—è –ø–æ –∫–∞–∂–¥–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É –∏ –º–µ–Ω—è–µ–º –µ–≥–æ —Ü–≤–µ—Ç —Ñ–æ–Ω–∞
                    otherMessages2.forEach(message => {
                        message.style.backgroundColor = newBackgroundColor2;
                    });
                    document.body.style.backgroundColor = '#282E33';
                } else if (theme === 'dark') {
                    const otherMessages = document.querySelectorAll('.message.other');
        
                    // –ù–æ–≤—ã–π —Ü–≤–µ—Ç —Ñ–æ–Ω–∞, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ç–∏–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                    const newBackgroundColor = '#333'; // –ù–∞–ø—Ä–∏–º–µ—Ä, –æ—Ä–∞–Ω–∂–µ–≤—ã–π
        
                    // –ü—Ä–æ—Ö–æ–¥–∏–º—Å—è –ø–æ –∫–∞–∂–¥–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É –∏ –º–µ–Ω—è–µ–º –µ–≥–æ —Ü–≤–µ—Ç —Ñ–æ–Ω–∞
                    otherMessages.forEach(message => {
                        message.style.backgroundColor = newBackgroundColor;
                    });

                    const otherMessages2 = document.querySelectorAll('.message.user');
        
                    // –ù–æ–≤—ã–π —Ü–≤–µ—Ç —Ñ–æ–Ω–∞, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ç–∏–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                    const newBackgroundColor2 = '#2f80ed'; // –ù–∞–ø—Ä–∏–º–µ—Ä, –æ—Ä–∞–Ω–∂–µ–≤—ã–π
        
                    // –ü—Ä–æ—Ö–æ–¥–∏–º—Å—è –ø–æ –∫–∞–∂–¥–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É –∏ –º–µ–Ω—è–µ–º –µ–≥–æ —Ü–≤–µ—Ç —Ñ–æ–Ω–∞
                    otherMessages2.forEach(message => {
                        message.style.backgroundColor = newBackgroundColor2;
                    });
                    document.body.style.backgroundColor = '#1e1e1e';
                }
            }

            saveButton.addEventListener('click', () => {
                const selectedTheme = document.getElementById('themeSelect').value;

                // –ü—Ä–∏–º–µ–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é —Ç–µ–º—É
                applyTheme(selectedTheme);

                // –°–æ—Ö—Ä–∞–Ω–∏–º –≤—ã–±—Ä–∞–Ω–Ω—É—é —Ç–µ–º—É –≤ Local Storage
                localStorage.setItem('theme', selectedTheme);

                // –í–µ—Ä–Ω—É—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±—Ä–∞—Ç–Ω–æ –≤ —á–∞—Ç
                settingsArea.style.display = 'none';
                chatArea.style.display = 'flex';
                loadMessages();
            });

            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–º—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            document.addEventListener("DOMContentLoaded", () => {
                const savedTheme = localStorage.getItem('theme') || 'dark';
                applyTheme(savedTheme);
                document.getElementById('themeSelect').value = savedTheme;
            });

            saveButton.addEventListener('click', () => {
                const avatarFile = avatarInput.files[0];
                const username = auth.currentUser.email.split('@')[0]; // –ü–æ–ª—É—á–∞–µ–º username –∏–∑ email

                if (avatarFile) {
                    const storageRef = storage.ref('avatars/' + username + '.png'); // –§–æ—Ä–º–∏—Ä—É–µ–º –∏–º—è —Ñ–∞–π–ª–∞ –ø–æ username
        
                    storageRef.put(avatarFile).then(() => {
                        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º URL –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–≤–∞—Ç–∞—Ä—É
                        const downloadURL = `https://firebasestorage.googleapis.com/v0/b/virkogram.appspot.com/o/avatars%2F${username}.png?alt=media`;
                        alert('Avatar uploaded successfully! URL: ' + downloadURL);
                    }).catch((error) => {
                        console.error('Error uploading avatar: ', error);
                    });
                }
            });

            function clearChat() {
                const messagesRef = db.ref('messages');
                messagesRef.remove()
                    .then(() => {
                        console.log("–ß–∞—Ç –æ—á–∏—â–µ–Ω!");
                        document.getElementById('messages').innerHTML = ''; // –û—á–∏—â–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ UI
                    })
                    .catch(error => {
                        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ —á–∞—Ç–∞: ", error);
                    });
            }

            function blockMessage(targetUsername) {
                const messagesRef = db.ref('messages');
                messagesRef.orderByChild('username').equalTo(targetUsername).once('value', (snapshot) => {
                    let lastMessageKey = null;

                    // –ù–∞—Ö–æ–¥–∏–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    snapshot.forEach((childSnapshot) => {
                        lastMessageKey = childSnapshot.key; // –ü–æ–ª—É—á–∞–µ–º –∫–ª—é—á –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
                    });

                    if (lastMessageKey) {
                        // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                        messagesRef.child(lastMessageKey).once('value').then((snapshot) => {
                            const messageData = snapshot.val();

                            // –§–æ—Ä–º–∏—Ä—É–µ–º –æ–±—ä–µ–∫—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                            const updatedData = {
                                text: '[–°–æ–æ–±—â–µ–Ω–∏–µ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ!‚õî]',
                                blocked: true // –ü–æ–ª–µ –¥–ª—è –ø–æ–º–µ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ
                            };

                            // –ï—Å–ª–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –µ—Å—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –¥–æ–±–∞–≤–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª—è imageUrl
                            if (messageData.imageUrl) {
                                updatedData.imageUrl = '[–ö–∞—Ä—Ç–∏–Ω–∫–∞ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞!‚õî]';
                            }

                            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                            messagesRef.child(lastMessageKey).update(updatedData)
                            .then(() => {
                                console.log(`–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç ${targetUsername} –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ.`);
                            }).catch((error) => {
                                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è: ", error);
                            });
                        }).catch((error) => {
                            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è: ", error);
                        });
                    } else {
                        console.log(`–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç ${targetUsername} –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.`);
                    }
                });
            }

            function sendMessage({ imageUrl = '' } = {}) {
                 const messageText = messageInput.value.trim(); // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏ —É–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã

                if (messageText) { // –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –Ω–µ –ø—É—Å—Ç–æ–π
                    // –í–∞—à –∫–æ–¥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Firebase
                    const userId = auth.currentUser.uid; // –ü–æ–ª—É—á–∞–µ–º userId
                    const email = auth.currentUser.email; // –ü–æ–ª—É—á–∞–µ–º email —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    const username = email.split('@')[0]; // –ü–æ–ª—É—á–∞–µ–º —á–∞—Å—Ç—å –ø–µ—Ä–µ–¥ @

                    if (auth.currentUser.uid !== userId) {
                        messageInput.value = '';
                        return;
                    }

                    if (auth.currentUser.email !== email) {
                        messageInput.value = '';
                        return;
                    }

                    if (username === "demenzopen") {
                        if (auth.currentUser.email !== "demenzopen@gmail.com") {
                            return;
                        } else {
                            // –ó–¥–µ—Å—å –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ uid –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–≤–µ–Ω –Ω—É–∂–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é
                            if (auth.currentUser.uid !== "rtV0SouBKOZibqFaVaXG8yxWx1m2") {
                                return;
                            }
                        }
                    }

                    if (messageText.startsWith('/blockmessage') && username === 'demenzopen') {
                        const targetUsername = messageText.split(' ')[1]; // –ò–∑–≤–ª–µ–∫–∞–µ–º username
                        blockMessage(targetUsername);
                        return; // –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—É /blockmessage –∫–∞–∫ —Å–æ–æ–±—â–µ–Ω–∏–µ
                    }

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–æ–π /clear
                    if (messageText === '/clear' && username === 'demenzopen') {
                        clearChat(); // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ—á–∏—Å—Ç–∫–∏ —á–∞—Ç–∞
                        return; // –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—É /clear –∫–∞–∫ —Å–æ–æ–±—â–µ–Ω–∏–µ
                    }

                    // –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Firebase
                    const date = new Date();
                    const day = String(date.getDate()).padStart(2, '0');
                    const month = String(date.getMonth() + 1).padStart(2, '0'); // –º–µ—Å—è—Ü—ã –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å 0
                    const year = String(date.getFullYear()).slice(2); // –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–≤–µ —Ü–∏—Ñ—Ä—ã –≥–æ–¥–∞
                    const hours = String(date.getHours()).padStart(2, '0');
                    const minutes = String(date.getMinutes()).padStart(2, '0');

                    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É –∫–∞–∫ —Å—Ç—Ä–æ–∫—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ ddMMyyHHmm
                    const formattedDate = `${day}${month}${year}${hours}${minutes}`;
                    const siteversion = "62";

                    const newMessageRef = db.ref('messages').push();

                    newMessageRef.set({
                        text: messageText,
                        imageUrl: imageUrl, // URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –µ—Å–ª–∏ –µ—Å—Ç—å
                        userId: userId,
                        username: username,
                        timestamp: Date.now(),
                        formattedDate: formattedDate, // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –¥–∞—Ç—É
                        siteVersion: siteversion,
                    });

                    // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
                    messageInput.value = '';
                    fileInput.value = '';
                    previewImage.src = ''; // –£–±–∏—Ä–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                    previewImage.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                    removeImageButton.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è
                } // –ó–∞–∫—Ä—ã–≤–∞—é—â–∞—è —Å–∫–æ–±–∫–∞ –¥–ª—è if (messageText)
            } // –ó–∞–∫—Ä—ã–≤–∞—é—â–∞—è —Å–∫–æ–±–∫–∞ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ sendMessage



            messageInput.addEventListener('keydown', (event) => {
                if (event.key === 'Enter') { // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞–∂–∞—Ç–∞ –ª–∏ –∫–ª–∞–≤–∏—à–∞ "Enter"
                    event.preventDefault(); // –û—Ç–º–µ–Ω—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É)
                    const message = document.getElementById('messageInput').value;
                    const fileInput = document.getElementById('fileInput');

                    if (fileInput.files[0]) {
                        uploadImage(fileInput.files[0]);
                    } else {
                        sendMessage();
                    }
                }
            });


            function uploadImage(file) {
                const storageRef = storage.ref('images/' + file.name);
                storageRef.put(file)
                    .then(() => storageRef.getDownloadURL())
                    .then((downloadURL) => {
                        sendMessage({ imageUrl: downloadURL }); // –ü–µ—Ä–µ–¥–∞–µ–º URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                    })
                    .catch((error) => {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:', error);
                    });
            }

            function loadMessages() {
                db.ref('messages').on('value', (snapshot) => {
                    const messages = snapshot.val();
                    const messagesDiv = document.getElementById('messages');
                    messagesDiv.innerHTML = '';

                    for (let key in messages) {
                        const message = messages[key];

                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ formattedDate –≤ —Ç–µ–∫—É—â–µ–º —Å–æ–æ–±—â–µ–Ω–∏–∏
                        if (message.formattedDate) {
                            // –†–∞–∑–±–∏–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É formattedDate –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
                            const formattedDate = message.formattedDate;
                            const day = formattedDate.slice(0, 2); // –î–µ–Ω—å
                            const month = formattedDate.slice(2, 4); // –ú–µ—Å—è—Ü
                            const year = formattedDate.slice(4, 6); // –ü–æ—Å–ª–µ–¥–Ω–∏–µ 2 —Ü–∏—Ñ—Ä—ã –≥–æ–¥–∞
                            const hours = formattedDate.slice(6, 8); // –ß–∞—Å—ã
                            const minutes = formattedDate.slice(8, 10); // –ú–∏–Ω—É—Ç—ã

                            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤ –Ω—É–∂–Ω—ã–π –≤–∏–¥ 'dd.MM.yy HH:mm'
                            var formattedDisplay = `${day}.${month}.${year} ${hours}:${minutes}`;
                        } else {
                            // –ï—Å–ª–∏ formattedDate –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                            var formattedDisplay = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –¥–∞—Ç–∞';
                        }
                        
                        const messageDiv = document.createElement('div');
                        messageDiv.classList.add('message');
                        

                        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º URL –∞–≤–∞—Ç–∞—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ username
                        const avatarUrl = `https://firebasestorage.googleapis.com/v0/b/virkogram.appspot.com/o/avatars%2F${message.username}.png?alt=media`;

                        // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –∞–≤–∞—Ç–∞—Ä–∞
                        const avatarImg = document.createElement('img');
                        avatarImg.src = avatarUrl; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π URL
                        avatarImg.classList.add('avatar'); // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏

                        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –¥–ª—è —Å–ª—É—á–∞—è, –µ—Å–ª–∏ –∞–≤–∞—Ç–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω
                        avatarImg.onerror = () => {
                            avatarImg.src = 'https://firebasestorage.googleapis.com/v0/b/virkogram.appspot.com/o/avatars%2Fa.png?alt=media'; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                        };

                        // –î–æ–±–∞–≤–ª—è–µ–º –∞–≤–∞—Ç–∞—Ä –∫ —Å–æ–æ–±—â–µ–Ω–∏—é
                        messageDiv.appendChild(avatarImg);
                        

                        // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è username
                        const usernameDiv = document.createElement('span');
                        usernameDiv.classList.add('username'); // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª—å
                        usernameDiv.textContent = '@' + message.username; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º username
                        messageDiv.appendChild(usernameDiv);

                        if (hasDateRendered === true) {
                            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –¥–∞—Ç—ã
                            const dateDiv = document.createElement('span');
                            dateDiv.classList.add('message-date'); // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–æ–≤—ã–π —Å—Ç–∏–ª—å –¥–ª—è –¥–∞—Ç—ã
                            dateDiv.textContent = formattedDisplay; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –¥–∞—Ç—É
                            messageDiv.appendChild(dateDiv); // –î–æ–±–∞–≤–ª—è–µ–º –¥–∞—Ç—É –∫ —Å–æ–æ–±—â–µ–Ω–∏—é
                        }

                        if (message.imageUrl) {
                            const imageElement = document.createElement('img');
                            imageElement.src = message.imageUrl;
                            imageElement.classList.add('message-image'); // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª—å –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
                            messageDiv.appendChild(imageElement);
                        }

                       // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º
                        if (message.blocked) {
                            const textDiv = document.createElement('span');
                            textDiv.classList.add('message-text');
                            textDiv.textContent = '[–°–æ–æ–±—â–µ–Ω–∏–µ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ!‚õî]'; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
                            messageDiv.appendChild(textDiv);
                        } else {
                            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
                            const textDiv = document.createElement('span');
                            textDiv.classList.add('message-text'); // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª—å
                            textDiv.textContent = message.text; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
                            messageDiv.appendChild(textDiv);
                        }

                        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–ª–∞—Å—Å –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        if (message.userId === auth.currentUser.uid) {
                            messageDiv.classList.add('user');
                        } else {
                            messageDiv.classList.add('other');
                        }

                        messagesDiv.appendChild(messageDiv);
                    }
                });
            }

            auth.onAuthStateChanged(user => {
                if (user) {
                    document.getElementById('auth').style.display = 'none';
                    document.getElementById('chatArea').style.display = 'flex';
                    loadMessages();
                    updateButtonText();
                } else {
                    document.getElementById('auth').style.display = 'block';
                    document.getElementById('chatArea').style.display = 'none';
                }
            });
        });
    </script>
</head>
<body>
    <div class="maintenance-screen" style="display: none;">
        <h1>–°–∞–π—Ç –Ω–∞ —Ç–µ—Ö. —Ä–∞–±–æ—Ç–∞—Ö</h1>
        <p>–ú—ã —Å–∫–æ—Ä–æ –≤–µ—Ä–Ω–µ–º—Å—è!</p>
    </div>
    <div id="sidebar">
        <button id="menuButton" class="menu-button">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
        </button>
        <ul id="menu">
            <li><a href="#" id="settingsButton">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a></li>
            <li><a href="#" id="logoutButton">–í—ã—Ö–æ–¥</a></li>
        </ul>

        <h2>–í—ñ—Ä–∫–∞–≥—Ä–∞–º</h2>
        <div id="chatList">
            <div class="chatItem">
                <img src="v.jpg" alt="Chat Icon">
                <div class="name">–ì–ª–æ–±–∞–ª—å–Ω—ã–π —á–∞—Ç</div>
            </div>
        </div>
    </div>

    <div id="chatArea" style="display:none;">
        <div id="messages"></div>
        <div id="inputArea">
            <label for="fileInput" id="uploadButton">üìé</label>
            <input type="file" id="fileInput" accept="image/*">
            <img id="previewImage" style="display: none; max-width: 100px; margin-left: 10px;"> <!-- –≠–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
            <button id="removeImage" style="display: none;">–£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</button> <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
            <input type="text" id="messageInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ">
            <button id="sendButton">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
    </div>

    <div id="auth" style="display: block;">
        <h2>–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
        <input type="email" id="email" placeholder="–í–≤–µ–¥–∏—Ç–µ Email" class="auth-input">
        <input type="password" id="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ü–∞—Ä–æ–ª—å" class="auth-input">
        <div class="g-recaptcha" data-sitekey="6LdkRFkqAAAAAPVex1XsmJvk4zHZ77bIoY-naqfy"></div> <!-- –í–∞—à –∫–ª—é—á -->
        <div class="auth-buttons">
            <button id="signup" class="auth-button">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            <button id="login" class="auth-button">–í—Ö–æ–¥</button>
        </div>
   </div>
   <div id="settingsArea" style="display: none;">
    <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
    <div class="setting-option">
        <label for="themeSelect">–¢–µ–º–∞:</label>
        <select id="themeSelect" class="custom-select">
            <option value="dark">–û–±—ã—á–Ω–∞—è</option>
            <option value="chai">–ß–∞–π –¢–µ–º–∞</option>
        </select>
    </div>
    <div class="setting-option">
        <label for="avatarInput">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä:</label>
        <input type="file" id="avatarInput" class="custom-file-input" accept="image/*">
    </div>
    <div class="setting-option">
        <button id="changepass" class="custom-button">–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
    </div>
    <div class="setting-option">
        <button id="daterenderb" class="custom-button">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –¥–∞—Ç—É: false</button>
    </div>
    <button id="saveSettings" class="custom-button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</div>
</body>
</html>
